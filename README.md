# Система управления билетами для выставок
Проект представляет собой консольное приложение для управления базой данных выставок, посетителей и билетов с использованием Entity Framework Core и паттерна Facade.

# Описание проекта
Система позволяет управлять данными о выставках, посетителях и проданных билетах. Реализованы все базовые CRUD-операции, а также аналитические запросы для получения статистики. Приложение использует паттерн Facade для упрощения взаимодействия с базой данных и предоставляет удобный консольный интерфейс.

## Диаграмма классов 
<img width="883" height="667" alt="dot_inline_dotgraph_1" src="https://github.com/user-attachments/assets/cad8f18c-cf8b-4f1c-86f9-d45419c5c88c" />

## Цикл работы
<img width="1032" height="401" alt="dot_inline_dotgraph_2" src="https://github.com/user-attachments/assets/80ce3809-45a2-401c-a027-65a5b8d5ab94" />


## Архитектура проекта
```text
TicketBookingSystem/
├── Core/                           # Основная бизнес-логика
│   ├── IDatabaseFacade.cs          # Интерфейс фасада
│   └── DatabaseFacade.cs           # Реализация фасада
├── DatabaseContext/                # Контекст базы данных
│   ├── ApplicationContext.cs       # DbContext приложения
│   └── DatabaseConfig.cs           # Конфигурация подключения
├── DatabaseModels/                 # Модели данных
│   ├── Visitor.cs                  # Модель посетителя
│   ├── Exhibition.cs               # Модель выставки
│   └── Ticket.cs                   # Модель билета
└── Presentation/                   # Презентационный слой
    ├── Program.cs                  # Точка входа и консольный интерфейс
    └── files/
        └── config.txt              # Файл конфигурации БД
```

## Требования
- .NET 6.0 или выше
- PostgreSQL база данных
- Файл конфигурации config.txt в папке Presentation/files/

## Схема базы данных
<img width="685" height="299" alt="dot_inline_dotgraph_3" src="https://github.com/user-attachments/assets/0a9691d9-994f-4b8e-9dea-77644533e604" />

## Настройка подключения к базе данных
Создайте файл config.txt в папке Presentation/files/ со следующим содержимым:

```text
host=localhost
port=5432
database=ExhibitionDB
username=ваш_пользователь
password=ваш_пароль
```

## Компиляция и запуск
```bash
# Переход в папку проекта
cd TicketBookingSystem
# Компиляция
dotnet build
# Запуск
dotnet run --project Presentation
```

## Функциональность
### Основные возможности:
**`Управление посетителями`**
- Добавление новых посетителей
- Просмотр всех посетителей
- Обновление информации о посетителях
- Удаление посетителей
  
**`Управление выставками`**
- Создание новых выставок
- Просмотр всех выставок
- Обновление информации о выставках
- Удаление выставок
  
**`Управление билетами`**
Продажа билетов
Просмотр всех проданных билетов
Обновление информации о билетах
Отмена/удаление билетов

**`Аналитика`**
- Количество проданных билетов на конкретную выставку
- Количество уникальных выставок, которые посетил конкретный посетитель
- Средний процент скидки у посетителей конкретной выставки

## Ключевые классы
**`DatabaseFacade`**
Назначение: Основной класс для работы с базой данных, реализующий паттерн Facade
Основные методы:
- CRUD-операции для всех сущностей (Visitor, Exhibition, Ticket)
- Аналитические методы: GetSoldTicketsCount(), GetUniqueExhibitionsCount(), GetAverageDiscountForExhibition()

**`ApplicationContext`**
Назначение: Контекст Entity Framework для работы с базой данных
Особенности:
- Настройка отношений между сущностями
- Каскадное удаление связанных записей
- Поддержка PostgreSQL через Npgsql

**`DatabaseConfig`**
Назначение: Загрузка конфигурации подключения к БД из файла
Особенности:
- Валидация обязательных параметров
- Генерация строки подключения

Примеры использования

Добавление посетителя:
``` text
=== Главное меню ===
1. Управление посетителями
2. Управление выставками
3. Управление билетами
4. Аналитика
0. Выход
Выберите действие: 1

=== Управление посетителями ===
1. Добавить посетителя
2. Показать всех посетителей
3. Обновить посетителя
4. Удалить посетителя
0. Назад
Выберите действие: 1

Введите имя посетителя: Иван Иванов
Введите размер скидки (0-100%): 10
Посетитель успешно добавлен.
```

Аналитика проданных билетов:
```text
=== Аналитика ===
1. Количество проданных билетов на выставку
2. Количество уникальных выставок у посетителя
3. Средний процент скидки у посетителей выставки
0. Назад
Выберите запрос: 1

=== Список выставок ===
ID: 1, Название: Современное искусство, Дата: 2024-06-15
ID: 2, Название: Фотография, Дата: 2024-07-20

Введите ID выставки: 1
На выставку с ID 1 продано 15 билетов.
```

## Технические особенности
- Entity Framework Core - ORM для работы с базой данных
- PostgreSQL - система управления базами данных
- Паттерн Facade - для упрощения взаимодействия с БД
- Dependency Injection - внедрение зависимостей

## Структура базы данных
```sql
CREATE TABLE Visitors (
    Id SERIAL PRIMARY KEY,
    Name VARCHAR(100) NOT NULL,
    Discount INTEGER CHECK (Discount >= 0 AND Discount <= 100)
);

CREATE TABLE Exhibitions (
    Id SERIAL PRIMARY KEY,
    Name VARCHAR(200) NOT NULL,
    Date TIMESTAMP NOT NULL
);

CREATE TABLE Tickets (
    Id SERIAL PRIMARY KEY,
    VisitorId INTEGER REFERENCES Visitors(Id) ON DELETE CASCADE,
    ExhibitionId INTEGER REFERENCES Exhibitions(Id) ON DELETE CASCADE,
    Price DECIMAL(10, 2) NOT NULL CHECK (Price > 0)
);
```
